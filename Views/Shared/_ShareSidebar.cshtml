@{
    var pageUrl = $"{Context.Request.Scheme}://{Context.Request.Host}{Context.Request.Path}";
    var pageTitle = ViewData["Title"]?.ToString() ?? "DfE Service Manual";
}

<div class="dfe-share-sidebar govuk-!-display-none-print">
    <h2 id="share-nav" class="dfe-share-sidebar__heading">Share this page</h2>
    <nav class="dfe-share-sidebar__nav" aria-labelledby="share-nav">
        <ul class="dfe-share-sidebar__list">
            <li class="dfe-share-sidebar__item">
                <button type="button" 
                        class="govuk-link dfe-share-sidebar__link" 
                        onclick="copyToClipboard('@pageUrl', this)"
                        aria-label="Copy link to clipboard">
                    Copy link to this page
                </button>
            </li>
            <li class="dfe-share-sidebar__item">
                <a href="https://twitter.com/intent/tweet?url=@Uri.EscapeDataString(pageUrl)&text=@Uri.EscapeDataString(pageTitle)" 
                   class="govuk-link dfe-share-sidebar__link" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   aria-label="Share on X (opens in new tab)">
                    Share on X
                </a>
            </li>
            <li class="dfe-share-sidebar__item">
                <a href="https://www.linkedin.com/sharing/share-offsite/?url=@Uri.EscapeDataString(pageUrl)" 
                   class="govuk-link dfe-share-sidebar__link" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   aria-label="Share on LinkedIn (opens in new tab)">
                    Share on LinkedIn
                </a>
            </li>
            <li class="dfe-share-sidebar__item">
                <a href="mailto:?subject=@Uri.EscapeDataString(pageTitle)&body=@Uri.EscapeDataString(pageUrl)" 
                   class="govuk-link dfe-share-sidebar__link"
                   aria-label="Share by email">
                    Email
                </a>
            </li>
        </ul>
    </nav>
</div>

<script>
    function copyToClipboard(text, button) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(function() {
                var originalText = button.textContent;
                button.textContent = 'Link copied';
                button.setAttribute('aria-label', 'Link copied to clipboard');
                setTimeout(function() {
                    button.textContent = originalText;
                    button.setAttribute('aria-label', 'Copy link to clipboard');
                }, 2000);
            }).catch(function() {
                fallbackCopyToClipboard(text, button);
            });
        } else {
            fallbackCopyToClipboard(text, button);
        }
    }

    function fallbackCopyToClipboard(text, button) {
        var textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            var originalText = button.textContent;
            button.textContent = 'Link copied';
            button.setAttribute('aria-label', 'Link copied to clipboard');
            setTimeout(function() {
                button.textContent = originalText;
                button.setAttribute('aria-label', 'Copy link to clipboard');
            }, 2000);
        } catch (err) {
            alert('Unable to copy link. Please copy manually: ' + text);
        }
        document.body.removeChild(textArea);
    }
</script>

